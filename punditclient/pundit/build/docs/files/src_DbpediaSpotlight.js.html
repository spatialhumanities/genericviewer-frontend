<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>src&#x2F;DbpediaSpotlight.js - Pundit</title>
	<link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
	<link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
	<link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
	<link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
	<script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

	<div id="doc">
		<div id="hd" class="yui3-g header">
			<div class="yui3-u-3-4">

				<h1><img src="http:&#x2F;&#x2F;thepund.it&#x2F;assets&#x2F;img&#x2F;pundit_500.png" title="Pundit"></h1>

			</div>
			<div class="yui3-u-1-4 version">
				<em>API Docs for: PUNDIT Project 0.12-Pumpkin</em>
			</div>
		</div>
		<div id="bd" class="yui3-g">

			<div class="yui3-u-1-4">
				<div id="docs-sidebar" class="sidebar apidocs">
					<div id="api-list">
						<h2 class="off-left">APIs</h2>

						<div id="api-tabview" class="tabview">
							<ul class="tabs">
								<li><a href="#api-classes">Classes</a></li>
								<li><a href="#api-modules">Modules</a></li>
							</ul>

							<div id="api-tabview-filter">
								<input type="search" id="api-filter" placeholder="Type to filter APIs">
							</div>

							<div id="api-tabview-panel">
								<ul id="api-classes" class="apis classes">

									<li><a href="..&#x2F;classes/pundit.annotators.AnnotatorsBase.html">pundit.annotators.AnnotatorsBase</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.annotators.AnnotatorsConductor.html">pundit.annotators.AnnotatorsConductor</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.annotators.FakeAnnotator.html">pundit.annotators.FakeAnnotator</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.annotators.TextFragmentAnnotator.html">pundit.annotators.TextFragmentAnnotator</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.authenticatedRequests.html">pundit.authenticatedRequests</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.baseComponent.html">pundit.baseComponent</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.BasePanel.html">pundit.BasePanel</a></li>

									<li><a href="..&#x2F;classes/pundit.CommentTag.html">pundit.CommentTag</a></li>

									<li><a href="..&#x2F;classes/pundit.CommentTagPanel.html">pundit.CommentTagPanel</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.Configuration.html">pundit.Configuration</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.contextualMenu.html">pundit.contextualMenu</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.DataTxt.html">pundit.DataTxt</a></li>

									<li>
										<a href="..&#x2F;classes/pundit.DbpediaSpotlight.html">pundit.DbpediaSpotlight</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.FastTextHandler.html">pundit.FastTextHandler</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.ImageAnnotationPanel.html">pundit.ImageAnnotationPanel</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.Init.html">pundit.Init</a></li>

									<li><a href="..&#x2F;classes/pundit.ItemContainerManager.html">pundit.ItemContainerManager</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.KorboBasketSelector.html">pundit.KorboBasketSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.myPundit.html">pundit.myPundit</a></li>

									<li><a href="..&#x2F;classes/pundit.NotebookManager.html">pundit.NotebookManager</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.PageHandler.html">pundit.PageHandler</a></li>

									<li><a href="..&#x2F;classes/pundit.Previewer.html">pundit.Previewer</a></li>

									<li><a href="..&#x2F;classes/pundit.RecognizerPanel.html">pundit.RecognizerPanel</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.ResourcesPanel.html">pundit.ResourcesPanel</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.BibServerSelector.html">pundit.selectors.BibServerSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.DBPediaSelector.html">pundit.selectors.DBPediaSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.EuropeanaSelector.html">pundit.selectors.EuropeanaSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.FreebaseSelector.html">pundit.selectors.FreebaseSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.SelectorBase.html">pundit.selectors.SelectorBase</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.VocabSelector.html">pundit.selectors.VocabSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.WordnetSelector.html">pundit.selectors.WordnetSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.TripleComposer.html">pundit.TripleComposer</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.XpointersHelper.html">pundit.XpointersHelper</a>
									</li>

								</ul>

								<ul id="api-modules" class="apis modules">

									<li><a href="..&#x2F;modules/pundit.html">pundit</a></li>

								</ul>
							</div>
						</div>
					</div>

				</div>
			</div>
			<div class="yui3-u-3-4">
				<div id="api-options">
					Show:
					<label for="api-show-inherited">
						<input type="checkbox" id="api-show-inherited" checked>
						Inherited
					</label>

					<label for="api-show-protected">
						<input type="checkbox" id="api-show-protected">
						Protected
					</label>

					<label for="api-show-private">
						<input type="checkbox" id="api-show-private">
						Private
					</label>
					<label for="api-show-deprecated">
						<input type="checkbox" id="api-show-deprecated">
						Deprecated
					</label>

				</div>

				<div class="apidocs">
					<div id="docs-main">
						<div class="content">
							<h1 class="file-heading">File: src&#x2F;DbpediaSpotlight.js</h1>

							<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * @class pundit.DbpediaSpotlight
 * @description Provides facilities to query the DBpedia Spotlight 
 * Annotation services and the DBpedia SPARQL endpoint. 
 *&#x2F;
dojo.provide(&quot;pundit.DbpediaSpotlight&quot;);
dojo.declare(&quot;pundit.DbpediaSpotlight&quot;, pundit.BaseComponent,{

    opts: {
        &#x27;confidence&#x27;: 0.15,
        &#x27;support&#x27;: 20
    },
    
    constructor:function(params) {
        var self = this;
        
        self.createCallback([&#x27;getTagsFromSpotlight&#x27;,&#x27;getInfoFromDBpedia&#x27;, &#x27;error&#x27;, &#x27;textLookup&#x27;, &#x27;lookupError&#x27;]);
        
        self.log(&quot;DBPedia Spotlight up and running&quot;);
    }, &#x2F;&#x2F; constructor()
    
    
    getEntities:function(lang, text, onSuccess, onError){
        var self = this;
        self.getTagsInfoFromDbpediaSpotlight(lang, text, onSuccess, onError);
    },
    
    getTagsInfoFromDbpediaSpotlight:function(lang, text, onSuccess, onError){
        var self = this;
            self.reqs = [];
        
        var args ={
            url: ns.annotationServerVocabProxy + &#x27;?url=&#x27; + encodeURIComponent(ns.dbpediaSpotlightAnnotate + encodeURIComponent(text) + &#x27;&amp;confidence=&#x27; + self.opts.confidence + &#x27;&amp;support=&#x27; + self.opts.support),
            handleAs: &quot;json&quot;,
            headers: {&quot;Accept&quot;:&quot;application&#x2F;json&quot;},
            failOk: true, &#x2F;&#x2F;required to avoid dojo to log the ajax request cancelation as an Error in console
            load: function(g) {
                self.tags = self.getTagItems(g);
                self.requests = {};
                if (self.tags.length === 0)
                    onError();
                    
                &#x2F;&#x2F;for (var i in self.tags){
                for (var i = self.tags.length; i--;){
                    if (typeof self.requests[self.tags[i].uri] === &#x27;undefined&#x27;){
                        self.requests[self.tags[i].uri] = &#x27;pending&#x27;,
                        self.reqs.push(self.getInfoFromDBpedia(
                            self.tags[i].uri, 
                            function(uri, item){
                                self.requests[uri] = &#x27;completed&#x27;;
                                &#x2F;&#x2F;for (var j in self.tags){
                                for (var j = self.tags.length; j--;){
                                    if (self.tags[j].uri === uri){
                                        self.tags[j][&#x27;pundit-items&#x27;] = [item];
                                    }
                                }
                                if (self.requestsCompleted()){
                                    onSuccess(self.tags);
                                }
                            },
                            function(uri){
                                self.requests[uri] = &#x27;error&#x27;;
                                for (var j = self.tags.length -1; j&gt;=0; j--){
                                    if (self.tags[j].uri === uri){
                                        self.tags.splice(j,1);
                                    }
                                }
                                if (self.requestsCompleted()){
                                    onSuccess(self.tags);
                                }
                            }
                        ));
                    }
                    
                }    
                
                &#x2F;&#x2F;self.fireOnGetTagsFromSpotlight(self.tags);
            },
            error: function(error) {
                &#x2F;&#x2F;Don&#x27;t do nothing if the request has been cancelled&#x27;
                if (error.dojoType===&#x27;cancel&#x27;) {
                    &#x2F;&#x2F;for (var i in self.reqs){
                    for (var i = self.reqs.length; i--;){
                        self.reqs[i].cancel();
                    }
                    return;}
                &#x2F;&#x2F;self.fireOnError(error);
                self.log(error);
                onError();
            }
        };
        return requester.xGet(args);
    },
    
    requestsCompleted:function(){
        var self = this;
        for (var i in self.requests){
            if (self.requests[i] === &#x27;pending&#x27;)
                return false;
        }
        return true;
    },
    
    getTagItems:function(tagObject){
        var tagsItem = [];
        if (typeof(tagObject.Resources) !== &#x27;undefined&#x27;){
            for (var i = tagObject.Resources.length -1; i &gt;= 0; i--){
                &#x2F;&#x2F;Ensure that item has at least rdftype resource
                var rdfType = tagObject.Resources[i][&#x27;@types&#x27;].replace(&#x2F;Schema:&#x2F;g,&#x27;http:&#x2F;&#x2F;schema.org&#x2F;&#x27;).replace(&#x2F;DBpedia:&#x2F;g,&#x27;http:&#x2F;&#x2F;dbpedia.org&#x2F;ontology&#x2F;&#x27;).replace(&#x2F;Freebase\:&#x2F;g,&#x27;http:&#x2F;&#x2F;www.freebase.com&#x2F;schema&#x27;).split(&#x27;,&#x27;);
                if (rdfType[0] === &quot;&quot;){
                    rdfType[0] = ns.rdfs_resource;
                }
                tagsItem.push({
                    uri: tagObject.Resources[i][&#x27;@URI&#x27;],
                    match: tagObject.Resources[i][&#x27;@surfaceForm&#x27;],
                    length: tagObject.Resources[i][&#x27;@surfaceForm&#x27;].length,
                    offset: tagObject.Resources[i][&#x27;@offset&#x27;]
                });
            }
        }
        return tagsItem;
    },
    
    getInfoFromDBpedia: function(myuri, f, fErr){
        var self = this,
        query =  &#x27;PREFIX rdfs: &lt;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;01&#x2F;rdf-schema#&gt;&#x27;;
        query += &#x27;SELECT ?comment, ?depiction, ?label, ?type &#x27;;
        query += &#x27;WHERE {&lt;&#x27; + myuri + &#x27;&gt; rdfs:comment ?comment. &#x27;;
        query += &#x27;&lt;&#x27; + myuri + &#x27;&gt; rdfs:label ?label. &#x27;;
        query += &#x27;OPTIONAL { &lt;&#x27; + myuri + &#x27;&gt; rdf:type ?type. }&#x27;;
        query += &#x27;OPTIONAL { &lt;&#x27; + myuri + &#x27;&gt;&lt;http:&#x2F;&#x2F;dbpedia.org&#x2F;ontology&#x2F;thumbnail&gt; ?depiction. }&#x27;;
        query += &#x27;FILTER ( lang(?label) = &quot;en&quot;) &#x27;;
        query += &#x27;FILTER ( lang(?comment) = &quot;en&quot;)} &#x27;;

        var args ={
            url: ns.annotationServerVocabProxy + &#x27;?url=&#x27; + encodeURIComponent(&#x27;http:&#x2F;&#x2F;dbpedia.org&#x2F;sparql?query=&#x27; + encodeURIComponent(query) + &#x27;&amp;output=json&#x27;),
            handleAs: &quot;json&quot;,
            headers: {
                &quot;Accept&quot;:&quot;application&#x2F;sparql-results+json&quot;
            },
            failOk: true, &#x2F;&#x2F;required to avoid dojo to log the ajax request cancelation as an Error in console
            id: myuri,
            load: function(r) {
                var item = {},
                    rdfTypes = [],
                    bindings = r.results.bindings,
                    i = bindings[0];
                if (typeof i !== &#x27;undefined&#x27;){
                    item.description = i.comment.value;
                    item.label = i.label.value;
                    if (typeof(i.depiction) !== &#x27;undefined&#x27;)
                        item.image = i.depiction.value;
                    &#x2F;&#x2F;for (var j in bindings){
                    for (var j = bindings.length; j--;){
                        if (typeof bindings[j].type !== &#x27;undefined&#x27;)
                            rdfTypes.push(bindings[j].type.value);
                    }
                    &#x2F;&#x2F;Some dbpedia resource has no type!
                    if (rdfTypes.length === 0){
                        rdfTypes = [ns.rdfs_resource];
                    }
                    item.rdftype = rdfTypes;
                    item.value = myuri;
                    item.type = [&#x27;subject&#x27;];
                    f(myuri, item);
                }else{
                    fErr(myuri);
                }
            },
            error: function(error) {
                &#x2F;&#x2F;Don&#x27;t do nothing if the request has been cancelled&#x27;
                if (error.dojoType===&#x27;cancel&#x27;) {
                    return;
                }
                console.log(&#x27;Dbpediaspotlight request error:&#x27; + error);
                &#x2F;&#x2F;self.fireOnError(error);
                self.log(error);
                fErr(myuri);
            }
        };
        return requester.xGet(args);
    },
    
    &#x2F;&#x2F;DEBUG Does anybody use this function???
    &#x2F;&#x2F; Lookup from dbpedia
&#x2F;&#x2F;    getDbpediaName: function(text) { 
&#x2F;&#x2F;        var self = this,
&#x2F;&#x2F;            settings = {      
&#x2F;&#x2F;                &#x27;endpoint&#x27; : ns.dbpediaKeywordSearch
&#x2F;&#x2F;            },
&#x2F;&#x2F;            params = {
&#x2F;&#x2F;                &#x27;QueryString&#x27;: text 
&#x2F;&#x2F;            };
&#x2F;&#x2F;      
&#x2F;&#x2F;        var args = {
&#x2F;&#x2F;            url: ns.annotationServerVocabProxy + &#x27;?url=&#x27; + encodeURIComponent(settings.endpoint + &#x27;?QueryString=&#x27; + encodeURIComponent(text)), 
&#x2F;&#x2F;            failOk: true,
&#x2F;&#x2F;            load: function(data){
&#x2F;&#x2F;                var jsResults = [],
&#x2F;&#x2F;                    jsdom = dojox.xml.DomParser.parse(data),
&#x2F;&#x2F;                    results = jsdom.documentElement.getElementsByTagName(&#x27;Result&#x27;);
&#x2F;&#x2F;                    
&#x2F;&#x2F;                for (var i in results){
&#x2F;&#x2F;                    var item = {};
&#x2F;&#x2F;                                        
&#x2F;&#x2F;                    item.type = [&#x27;subject&#x27;]
&#x2F;&#x2F;                    item.value = results[i].childrenByName(&#x27;URI&#x27;)[0].childNodes[0].nodeValue;
&#x2F;&#x2F;                    item.label = results[i].childrenByName(&#x27;Label&#x27;)[0].childNodes[0].nodeValue;
&#x2F;&#x2F;                    try {
&#x2F;&#x2F;                        item.description = results[i].childrenByName(&#x27;Description&#x27;)[0].childNodes[0].nodeValue;
&#x2F;&#x2F;                    } catch(e){}
&#x2F;&#x2F;                    
&#x2F;&#x2F;                    var types = [],
&#x2F;&#x2F;                        c = results[i].childrenByName(&#x27;Classes&#x27;)[0].childrenByName(&#x27;Class&#x27;);
&#x2F;&#x2F;
&#x2F;&#x2F;                    for (var j in c)
&#x2F;&#x2F;                        types.push(c[j].childrenByName(&#x27;URI&#x27;)[0].childNodes[0].nodeValue);
&#x2F;&#x2F;                    
&#x2F;&#x2F;                    &#x2F;&#x2F; Add a type for resources that have no type
&#x2F;&#x2F;                    if (types.length === 0)
&#x2F;&#x2F;                        types = [ns.rdfs_resource];
&#x2F;&#x2F;                    item.rdftype = types;
&#x2F;&#x2F;                    jsResults.push(item);
&#x2F;&#x2F;                }
&#x2F;&#x2F;                self.fireOnTextLookup(jsResults);
&#x2F;&#x2F;            },
&#x2F;&#x2F;            error: function(error){
&#x2F;&#x2F;                if (error.dojoType===&#x27;cancel&#x27;) {return}
&#x2F;&#x2F;                console.log(&#x27;Lookup Error:&#x27; + error);
&#x2F;&#x2F;                self.fireOnLookupError(error);
&#x2F;&#x2F;            }
&#x2F;&#x2F;        };
&#x2F;&#x2F;        return requester.xGet(args);
&#x2F;&#x2F;    },
    
    getYouTubeVideoInfoById:function(videoId){
        dojo.io.script.get({
            callbackParamName: &quot;callback&quot;,
            url: &quot;http:&#x2F;&#x2F;gdata.youtube.com&#x2F;feeds&#x2F;api&#x2F;videos&#x2F;&quot; + videoId + &quot;?alt=json&quot;,
            load: function(r) {
                console.log(r);
            },
            error: function(response, ioArgs) {
                self.log(&quot;getSuggestionsForTerm got an error :(&quot;);
                self.setLoading(false);
            }
        });
    }
});


    </pre>
							</div>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
	<script>prettyPrint();</script>
	<script src="..&#x2F;assets/js/yui-prettify.js"></script>
	<script src="..&#x2F;assets/../api.js"></script>
	<script src="..&#x2F;assets/js/api-filter.js"></script>
	<script src="..&#x2F;assets/js/api-list.js"></script>
	<script src="..&#x2F;assets/js/api-search.js"></script>
	<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
