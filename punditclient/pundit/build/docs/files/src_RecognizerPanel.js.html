<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src&#x2F;RecognizerPanel.js - Pundit</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http:&#x2F;&#x2F;thepund.it&#x2F;assets&#x2F;img&#x2F;pundit_500.png" title="Pundit"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: PUNDIT Project 0.12-Pumpkin</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/pundit.annotators.AnnotatorsBase.html">pundit.annotators.AnnotatorsBase</a></li>
            
                <li><a href="..&#x2F;classes/pundit.annotators.AnnotatorsConductor.html">pundit.annotators.AnnotatorsConductor</a></li>
            
                <li><a href="..&#x2F;classes/pundit.annotators.FakeAnnotator.html">pundit.annotators.FakeAnnotator</a></li>
            
                <li><a href="..&#x2F;classes/pundit.annotators.TextFragmentAnnotator.html">pundit.annotators.TextFragmentAnnotator</a></li>
            
                <li><a href="..&#x2F;classes/pundit.authenticatedRequests.html">pundit.authenticatedRequests</a></li>
            
                <li><a href="..&#x2F;classes/pundit.baseComponent.html">pundit.baseComponent</a></li>
            
                <li><a href="..&#x2F;classes/pundit.BasePanel.html">pundit.BasePanel</a></li>
            
                <li><a href="..&#x2F;classes/pundit.CommentTag.html">pundit.CommentTag</a></li>
            
                <li><a href="..&#x2F;classes/pundit.CommentTagPanel.html">pundit.CommentTagPanel</a></li>
            
                <li><a href="..&#x2F;classes/pundit.Configuration.html">pundit.Configuration</a></li>
            
                <li><a href="..&#x2F;classes/pundit.contextualMenu.html">pundit.contextualMenu</a></li>
            
                <li><a href="..&#x2F;classes/pundit.DataTxt.html">pundit.DataTxt</a></li>
            
                <li><a href="..&#x2F;classes/pundit.DbpediaSpotlight.html">pundit.DbpediaSpotlight</a></li>
            
                <li><a href="..&#x2F;classes/pundit.FastTextHandler.html">pundit.FastTextHandler</a></li>
            
                <li><a href="..&#x2F;classes/pundit.ImageAnnotationPanel.html">pundit.ImageAnnotationPanel</a></li>
            
                <li><a href="..&#x2F;classes/pundit.Init.html">pundit.Init</a></li>
            
                <li><a href="..&#x2F;classes/pundit.ItemContainerManager.html">pundit.ItemContainerManager</a></li>
            
                <li><a href="..&#x2F;classes/pundit.KorboBasketSelector.html">pundit.KorboBasketSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.myPundit.html">pundit.myPundit</a></li>
            
                <li><a href="..&#x2F;classes/pundit.NotebookManager.html">pundit.NotebookManager</a></li>
            
                <li><a href="..&#x2F;classes/pundit.PageHandler.html">pundit.PageHandler</a></li>
            
                <li><a href="..&#x2F;classes/pundit.Previewer.html">pundit.Previewer</a></li>
            
                <li><a href="..&#x2F;classes/pundit.RecognizerPanel.html">pundit.RecognizerPanel</a></li>
            
                <li><a href="..&#x2F;classes/pundit.ResourcesPanel.html">pundit.ResourcesPanel</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.BibServerSelector.html">pundit.selectors.BibServerSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.DBPediaSelector.html">pundit.selectors.DBPediaSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.EuropeanaSelector.html">pundit.selectors.EuropeanaSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.FreebaseSelector.html">pundit.selectors.FreebaseSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.SelectorBase.html">pundit.selectors.SelectorBase</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.VocabSelector.html">pundit.selectors.VocabSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.WordnetSelector.html">pundit.selectors.WordnetSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.TripleComposer.html">pundit.TripleComposer</a></li>
            
                <li><a href="..&#x2F;classes/pundit.XpointersHelper.html">pundit.XpointersHelper</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/pundit.html">pundit</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src&#x2F;RecognizerPanel.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

&#x2F;**
 * @class pundit.RecognizerPanel
 * @extends pundit.ResourcesPanel
 * @description Provides a GUI (floating Panel) for recognizing a selected text fragment
 * searching in different sources (&#x27;My Item&#x27;, &#x27;Page Items&#x27;, Vocabularies) and from lookup services
 * Freebase, Dbpedia and Wordnet.
 * It extend the Resource Panel search capability with the possibity to selected
 * searched tags and use to compose a triple &lt;br&gt;
 * :fragment rdfs:seeAlso tag1, tag2, ...
 *&#x2F;
dojo.provide(&quot;pundit.RecognizerPanel&quot;);
dojo.declare(&quot;pundit.RecognizerPanel&quot;, pundit.ResourcesPanel, {
    &#x2F;&#x2F; TODO: move this comment to some @property and some into the class declaration
    &#x2F;&#x2F; TODO: same comment as in comment tag ??!
    &#x2F;*
    * @constructor
    * @description Initializes the component
    * @param options {object}
    *   @param options.name {string} the name of the panel used to create a unique id
    *   @param options.title {string} the title of the panel 
    *   @param options.drag {boolean} if set to true it enable the panel to be dragged
    *   @param options.preview {boolean} if set to true enable the preview visualization (
    *       otherwise the normal preview (in Pundit Window) is used
    *       assigned explicitly dojo&#x27;s &#x27;declaredClass&#x27; field will be used.
    *   @param options.keyInputTimerLength {number} The number of milliseconds to
    *       to wait after a keystroke before querying the service. Default:500
    *   @param options.maxShownItems {number} Max number of items shown in each source container.
    *       Default = 4
    *   @param options.suggestionPanels {object} .
    * &lt;br&#x2F;&gt;
    * An object representing the source used for the recognition.
    * Example:&lt;br&#x2F;&gt;
    * &lt;code&gt;{&lt;br&#x2F;&gt;
    *   myitems: {&lt;br&#x2F;&gt;
    *       label:&#x27;My Items&#x27;&lt;br&#x2F;&gt;
    *       }, &lt;br&#x2F;&gt;
    *   pageitems: {&lt;br&#x2F;&gt;
    *       label: &#x27;Page Items&#x27;&lt;br&#x2F;&gt;
    *       }, &lt;br&#x2F;&gt;
    *   properties: {&lt;br&#x2F;&gt;
    *       label: &#x27;Properties&#x27;,&lt;br&#x2F;&gt;
    *       expanded: true&lt;br&#x2F;&gt;
    *       }&lt;br&#x2F;&gt;
    * }&lt;code&#x2F;&gt;&lt;br&#x2F;&gt;
    * Where label represent the shown label. Containers are collapsed by defualt unless
    * expanded is set to true.
    *   @param options.namedEntitiesSources {object} An object representing the source 
    * used for the lookup. Default is {} meaning that there is no lookup.&lt;br&gt;
    * To enable lookup from Freebase and Dbpedia:&lt;br&gt;
    * {&lt;br&#x2F;&gt;
    *   freebase:{label: &#x27;Freebase&#x27;},&lt;br&gt;
    *   dbpedia:{label:&#x27;DBpedia&#x27;},&lt;br&gt;
    *   wordnet:{label:&#x27;Wordnet&#x27;}&lt;br&gt;
    * }&lt;br&gt;
    *   @param options.searchType {string} The type of search that is performed. Two
    * kind of searches are supported.&lt;br&gt; 
    * Default is &#x27;filter&#x27; which filters the items according to input string 
    * restricting the shown items&lt;br&gt;
    * &#x27;search&#x27; search in all the items source
    *&#x2F;
    constructor:function(options){
        var self = this;
        &#x2F;&#x2F;Handle saving
        self.saver = new pundit.AnnotationWriter({debug: self.opts.debug});
        self.saver.onSaveItems(function(annotationID) {
            self.log(&#x27;onSaveItems: Saver answered with &#x27;+ annotationID);
            self.saved = true;
                    &#x2F;&#x2F; On close, remove the highlight, and avoid an opening highlight
            self.hide();
            tooltip_viewer.refreshAnnotations();
        });
        self.saver.onSave(function(m){
            self.log(&#x27;onSave: Saver answered with &#x27;+m);
            self.saveItems(m);
        });
        &#x2F;&#x2F;DEBUG Use callback instead of a function
        self.onItemAdded(self.addItem);
        
    },
    initHTML:function(){
        this.inherited(arguments);
        var self = this;
        var c = &#x27;&lt;div class=&quot;pundit-rp-panel-tags-container pundit-rp-container-suggestions pundit-visible pundit-expanded pundit-floating-panel-container&quot;&gt;&#x27;;
        c += &#x27;      &lt;div&gt;&#x27;;
        c += &#x27;          &lt;span class=&quot;pundit-pane-title pundit-rp-title&quot;&gt;Selected Entities:&lt;&#x2F;span&gt;&#x27;;
        c += &#x27;          &lt;div class=&quot;pundit-pane&quot;&gt;&lt;ul class=&quot;pundit-rp-tags pundit-items pundit-view-list showsRemoveButton pundit-stop-wheel-propagation&quot;&gt;&lt;&#x2F;ul&gt;&lt;&#x2F;div&gt;&#x27;;
        c += &#x27;      &lt;&#x2F;div&gt;&#x27;;
        c += &#x27;   &lt;&#x2F;div&gt;&#x27;;
        c += &#x27;   &lt;div class=&quot;pundit-rp-button-container&quot;&gt;&#x27;;
        c += &#x27;   &lt;span class=&quot;pundit-rp-save-button pundit-gui-button pundit-button-disabled&quot;&gt;Save&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;&#x27;;

        dojo.query(&#x27;#&#x27; + self._id + &#x27; .pundit-rp-container-search&#x27;).prepend(c);
    },
    initDnD:function(){
        this.inherited(arguments);
        var self = this;
        self.tagsDnD = new dojo.dnd.Target(dojo.query(&#x27;#&#x27; + self._id + &#x27; .pundit-rp-tags&#x27;)[0],{
            copyOnly: true,
            creator: semlibItems.itemNodeCreator,
            checkAcceptance: function(source, nodes) {
                if (self.acceptSource(source)){
                    &#x2F;&#x2F;for (var i in nodes){
                    for (var i = nodes.length; i--;){
                        if (self.uriInItems(source.getItem(nodes[i].id).data.value))
                            return false;
                        else
                            return true;
                    }
                    return true;
                }
                else{
                    return false;
                }
            }
        });
    },
    initBehaviors: function() {
        this.inherited(arguments);
        var self = this;
        
        dojo.connect(dojo.query(&#x27;#&#x27; + self._id + &#x27; .pundit-rp-save-button&#x27;)[0], &#x27;onclick&#x27;, function(e){
            if (!dojo.hasClass(dojo.query(&#x27;#&#x27; + self._id + &#x27; .pundit-rp-save-button&#x27;)[0], &#x27;pundit-button-disabled&#x27;)) {
                self.saveTriples();
                console.log(&#x27;zzzzz__________________&#x27;);
            } else
                console.log(&#x27;Not saving.&#x27;);
        });
        var beh = {};
        beh[&#x27;#&#x27; + self._id + &#x27; .pundit-rp-tags li.dojoDndItem span.pundit-item-remove-button&#x27;] = {
            &#x27;onclick&#x27;:function(e){
                self.removeTag(e);
            }
        };
        beh[&#x27;#&#x27;+ self._id + &#x27; .pundit-rp-tags&#x27; + &#x27; li.dojoDndItem&#x27;] = {
            &#x27;onmouseover&#x27;:function(e){
                self.onItemMouseOver(e);
            },
            &#x27;onmouseout&#x27;:function(e){
                self.onItemMouseOut(e);
            }
        };
        dojo.behavior.add(beh);
        dojo.behavior.apply();
        
        dojo.subscribe(&quot;&#x2F;dnd&#x2F;drop&quot;, function(source, nodes, copy, target) {
            if (target === self.tagsDnD){
                &#x2F;&#x2F;DEBUG Simone: If called as soon as the item is dropped item 
                &#x2F;&#x2F;has not been added yet and the update fails. Any hint?
                setTimeout(function(){self.updateSaveBtn();},100);
            }
        });
    },
    saveTriples: function(){
        var self = this;
        var annotationPageContext = window.location.href,
            b = new pundit.TriplesBucket();

        &#x2F;&#x2F; Tags triples
        for (var j in self.tagsDnD.map){
            var item = self.tagsDnD.map[j];
            b.addTriple(self.target, ns.rdfs_seeAlso, item.data.value, &#x27;uri&#x27;);
        }

        if (!b.isEmpty()) {
            self.log(&#x27;Saving triples json: &#x27; + dojo.toJson(b.getTalisJson()));
            self.saver.writeAnnotationContent(b, [self.target], annotationPageContext);
        } else {
            self.log(&#x27;Empty bucket in saveTriples??!&#x27;);
        }
    }, &#x2F;&#x2F; saveTriples()

     &#x2F;* Saves to the pundit server the current composed triples.
     * @method saveTriples
     *&#x2F;
     saveItems: function(annotationID) {
        var self = this,
        b = new pundit.TriplesBucket(),
        items = [],
        item = _PUNDIT.items.getItemByUri(self.target);
        items.push(item.rdfData);
        
        self.tagsDnD.forInItems(function(item) {items.push(item.data.rdfData);});
        
        &#x2F;&#x2F;for (var i in items){
        for (var i = items.length; i--;){
            b.concatBucket(items[i]);
        }
        
        &#x2F;&#x2F;Property Metadata
        b.addTriple(ns.rdfs_seeAlso, ns.rdf_type, ns.rdf_property, &#x27;uri&#x27;);
        b.addTriple(ns.rdfs_seeAlso, ns.rdfs_label, &#x27;see also&#x27;, &#x27;literal&#x27;);
        
        if (!b.isEmpty()) {
            self.log(&#x27;Posting &#x27;+items.length+&#x27; items with &#x27;+b.bucket.length+&#x27; triples..&#x27;);
            self.saver.writeAnnotationItems(annotationID, dojo.toJson(b.getTalisJson()));
        } else {
            self.log(&#x27;saveItems with an empty bucket??!&#x27;);
        }
        &#x2F;&#x2F;tooltip_viewer.removeHighlightByXpointer(self.xpTarget);
        &#x2F;&#x2F;tooltip_viewer.removeTempXpointer(self.xpTarget);

    }, &#x2F;&#x2F; saveItems()
    &#x2F;&#x2F;Return true if the source is one of the panel sources
    acceptSource:function(source){
        var self=this;
        for (var i in self.panels){
            if (source === self[&#x27;itemsDnD&#x27; + i])
                return true;
        }
            return false;
    },
    &#x2F;&#x2F;TODO This function is also in comment tag panel. Should we add a Helper Class
    &#x2F;&#x2F;Check if the item is already in tag container 
    uriInItems:function(uri){
        var self = this,
            inItems = false;
        
        self.tagsDnD.forInItems(function(item){
            if (item.data.value === uri){
                inItems = true;
                return;
            }   
        });
        return inItems;
    },
    show:function(x,y, params){
        this.inherited(arguments);
        var self = this,
            item;
        self.tempItemAdded = false;&#x2F;&#x2F;Track if the added temp item has to be removed
        self.saved = false;
        self.target = params.target.value;
        item = params.target; 
        self.updateSaveBtn();
        if (!semlibItems.uriInItems(self.target)) {
            semlibItems.addItem(item);
            self.tempItemAdded = true;
            previewer.buildPreviewForItem(item);
        }
                
        if (!tooltip_viewer.isTempXpointer(self.target)){
            if (self.target !== window.location.href)
                tooltip_viewer.tempXpointers.push(self.target);
                &#x2F;&#x2F;tooltip_viewer.refreshAnnotations();
                &#x2F;&#x2F; DEBUG: not sure we can avoid the refreshAnnotations() process
                &#x2F;&#x2F;tooltip_viewer.consolidate();   
        }
        
        tooltip_viewer.highlightByXpointer(self.target);
    }, 
    hide:function(){
        this.inherited(arguments);
        var self = this;
        dojo.empty(dojo.query(&#x27;#&#x27; + self._id + &#x27; ul.pundit-rp-tags&#x27;));
        self.tagsDnD.selectAll();
        self.tagsDnD.deleteSelectedNodes();
        self.tagsDnD.sync();
        &#x2F;&#x2F; on next consolidate
        tooltip_viewer.removeHighlightByXpointer(self.target);
        &#x2F;&#x2F;Remove the xpointer from the tempXpointers
        tooltip_viewer.removeTempXpointer(self.target);

        if (!self.saved){
            semlibItems.removeItemFromUri(self.target);
            tooltip_viewer.consolidate();
            &#x2F;&#x2F;tooltip_viewer.refreshAnnotations();
        }
    },
    &#x2F;&#x2F;Add the item to the tag container
    addItem:function(item){
        var self = this;
        if (!self.uriInItems(item.value))
            self.tagsDnD.insertNodes(false, [item]);
        self.updateSaveBtn();
        dojo.behavior.apply();
    },
    
    removeTag:function(e){
        var self=this,
            node = dojo.query(dojo.query(e.target).parent()[0]),
            uri = self.tagsDnD.getItem(node[0].id).data.value;
        self.tagsDnD.deleteSelectedNodes();
        dojo.destroy(node);
        dojo.behavior.apply();
        self.updateSaveBtn();
    },
    onItemMouseOver:function(e){
        var self=this,
            node,
            nodeUri;

        if (e.target.nodeName === &#x27;LI&#x27;){
            node = dojo.query(e.target);
        }else{
            node = dojo.query(dojo.query(e.target).parent()[0]);
        }
                    
        nodeUri = self.tagsDnD.getItem(node[0].id).data.value;
        &#x2F;&#x2F;previewer.selectAndPreviewItemWithId(node[0].id, nodeUri);
        self.showPreview(nodeUri);
    },
    onItemMouseOut:function(e){
        &#x2F;&#x2F;Override to add functionality on mouse out
    }

});
   
   


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
