<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>src&#x2F;selectors&#x2F;SelectorBase.js - Pundit</title>
	<link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
	<link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
	<link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
	<link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
	<script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

	<div id="doc">
		<div id="hd" class="yui3-g header">
			<div class="yui3-u-3-4">

				<h1><img src="http:&#x2F;&#x2F;thepund.it&#x2F;assets&#x2F;img&#x2F;pundit_500.png" title="Pundit"></h1>

			</div>
			<div class="yui3-u-1-4 version">
				<em>API Docs for: PUNDIT Project 0.12-Pumpkin</em>
			</div>
		</div>
		<div id="bd" class="yui3-g">

			<div class="yui3-u-1-4">
				<div id="docs-sidebar" class="sidebar apidocs">
					<div id="api-list">
						<h2 class="off-left">APIs</h2>

						<div id="api-tabview" class="tabview">
							<ul class="tabs">
								<li><a href="#api-classes">Classes</a></li>
								<li><a href="#api-modules">Modules</a></li>
							</ul>

							<div id="api-tabview-filter">
								<input type="search" id="api-filter" placeholder="Type to filter APIs">
							</div>

							<div id="api-tabview-panel">
								<ul id="api-classes" class="apis classes">

									<li><a href="..&#x2F;classes/pundit.annotators.AnnotatorsBase.html">pundit.annotators.AnnotatorsBase</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.annotators.AnnotatorsConductor.html">pundit.annotators.AnnotatorsConductor</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.annotators.FakeAnnotator.html">pundit.annotators.FakeAnnotator</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.annotators.TextFragmentAnnotator.html">pundit.annotators.TextFragmentAnnotator</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.authenticatedRequests.html">pundit.authenticatedRequests</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.baseComponent.html">pundit.baseComponent</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.BasePanel.html">pundit.BasePanel</a></li>

									<li><a href="..&#x2F;classes/pundit.CommentTag.html">pundit.CommentTag</a></li>

									<li><a href="..&#x2F;classes/pundit.CommentTagPanel.html">pundit.CommentTagPanel</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.Configuration.html">pundit.Configuration</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.contextualMenu.html">pundit.contextualMenu</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.DataTxt.html">pundit.DataTxt</a></li>

									<li>
										<a href="..&#x2F;classes/pundit.DbpediaSpotlight.html">pundit.DbpediaSpotlight</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.FastTextHandler.html">pundit.FastTextHandler</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.ImageAnnotationPanel.html">pundit.ImageAnnotationPanel</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.Init.html">pundit.Init</a></li>

									<li><a href="..&#x2F;classes/pundit.ItemContainerManager.html">pundit.ItemContainerManager</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.KorboBasketSelector.html">pundit.KorboBasketSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.myPundit.html">pundit.myPundit</a></li>

									<li><a href="..&#x2F;classes/pundit.NotebookManager.html">pundit.NotebookManager</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.PageHandler.html">pundit.PageHandler</a></li>

									<li><a href="..&#x2F;classes/pundit.Previewer.html">pundit.Previewer</a></li>

									<li><a href="..&#x2F;classes/pundit.RecognizerPanel.html">pundit.RecognizerPanel</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.ResourcesPanel.html">pundit.ResourcesPanel</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.BibServerSelector.html">pundit.selectors.BibServerSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.DBPediaSelector.html">pundit.selectors.DBPediaSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.EuropeanaSelector.html">pundit.selectors.EuropeanaSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.FreebaseSelector.html">pundit.selectors.FreebaseSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.SelectorBase.html">pundit.selectors.SelectorBase</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.VocabSelector.html">pundit.selectors.VocabSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.selectors.WordnetSelector.html">pundit.selectors.WordnetSelector</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.TripleComposer.html">pundit.TripleComposer</a>
									</li>

									<li><a href="..&#x2F;classes/pundit.XpointersHelper.html">pundit.XpointersHelper</a>
									</li>

								</ul>

								<ul id="api-modules" class="apis modules">

									<li><a href="..&#x2F;modules/pundit.html">pundit</a></li>

								</ul>
							</div>
						</div>
					</div>

				</div>
			</div>
			<div class="yui3-u-3-4">
				<div id="api-options">
					Show:
					<label for="api-show-inherited">
						<input type="checkbox" id="api-show-inherited" checked>
						Inherited
					</label>

					<label for="api-show-protected">
						<input type="checkbox" id="api-show-protected">
						Protected
					</label>

					<label for="api-show-private">
						<input type="checkbox" id="api-show-private">
						Private
					</label>
					<label for="api-show-deprecated">
						<input type="checkbox" id="api-show-deprecated">
						Deprecated
					</label>

				</div>

				<div class="apidocs">
					<div id="docs-main">
						<div class="content">
							<h1 class="file-heading">File: src&#x2F;selectors&#x2F;SelectorBase.js</h1>

							<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * @class pundit.selectors.SelectorBase
 * @extends pundit.baseComponent
 * @description Base class for Pundit Selectors. 
 * TODO TODO TODO TODO 
 *&#x2F;
dojo.provide(&quot;pundit.selectors.SelectorBase&quot;);
dojo.declare(&quot;pundit.selectors.SelectorBase&quot;, pundit.BaseComponent, {


    &#x2F;&#x2F; TODO: this .opts field doesnt get extended by subclasses but overwritten!
    opts: {

        &#x2F;&#x2F; Number of items to display in the suggestion list
        limit: 100,

        &#x2F;&#x2F; Minimum number of characters to trigger a query to the server 
        keywordMinimumLength: 3,

        &#x2F;&#x2F; Ms to wait after a keystroke before querying the service
        keyInputTimerLength: 500,
        
        layouts: [&#x27;pundit-view-list&#x27;, &#x27;pundit-view-tile&#x27;]
    },

    constructor: function(options) {

        var self = this;
        
        &#x2F;&#x2F; TODO abort if name is already taken? Add a string and make it unique?
        self.name = options.name;
        self.label = options.label || options.name;

        self.initPanel();
        self.initDnD();

        self._lastKeyword = &#x27;&#x27;;
        
        self.keyInputTimer = null;
        self.initBehaviors();
        
        self.log(&#x27;Selector &#x27;+self.name+&#x27; base setup completed.&#x27;);

    }, &#x2F;&#x2F; constructor()

    initDnD: function() {
        var self = this;

        &#x2F;&#x2F; items does not accept any item; dnd copies items from it
        self.itemsDnD = new dojo.dnd.Source(self._id+&#x27;-items&#x27;, {
            copyOnly: true, 
            creator: semlibItems.itemNodeCreator,
            checkAcceptance: function() { return false; }
        });
    },
    
    initPanel: function() {
        var self = this,
            html = &#x27;&#x27;;

        self._id = &#x27;pundit-sel-&#x27; + self.name; 
            
        html += &#x27;&lt;div id=&quot;&#x27;+self._id+&#x27;&quot; class=&quot;pundit-sel-container semlib-panel&quot;&gt;&#x27;;
        html += &#x27;   &lt;div&gt;&lt;input type=&quot;text&quot; placeholder=&quot;.. search!&quot; id=&quot;&#x27;+self._id+&#x27;-input&quot; class=&quot;pundit-sel-dialog-input&quot; &#x2F;&gt;&#x27;;
        html += &#x27;       &lt;span id=&quot;&#x27;+self._id+&#x27;-message&quot; class=&quot;pundit-sel-message&quot;&gt;&lt;&#x2F;span&gt;&#x27;;
        html += &#x27;       &lt;span class=&quot;pundit-sort-items pundit-view-tile&quot;&gt;&lt;&#x2F;span&gt;&lt;span class=&quot;pundit-sort-items pundit-view-list pundit-selected&quot;&gt;&lt;&#x2F;span&gt;&#x27;;
        html += &#x27;   &lt;&#x2F;div&gt;&#x27;;
        html += &#x27;   &lt;div class=&quot;pundit-items-container&quot;&gt;&#x27;;
        html += &#x27;       &lt;ul id=&quot;&#x27;+self._id+&#x27;-items&quot; class=&quot;pundit-items pundit-view-list&quot;&gt;&lt;&#x2F;ul&gt;&#x27;;
        html += &#x27;       &lt;span class=&quot;pundit-error-message&quot;&gt;&#x27; + self.name + &#x27; is not responding&lt;&#x2F;span&gt;&#x27;;
        html += &#x27;   &lt;&#x2F;div&gt;&#x27;;
        html += &#x27;&lt;&#x2F;div&gt;&#x27;;

        dojo.query(&#x27;#pundit-vocabs-container ul.pundit-item-filter-list&#x27;).append(&#x27;&lt;li id=&quot;&#x27;+self._id+&#x27;-filter&quot;&gt;&#x27;+self.label+&#x27;&lt;&#x2F;li&gt;&#x27;);

        &#x2F;&#x2F; TODO: factor this elsewhere, PLEASE, for example the container could
        &#x2F;&#x2F; accept a name and the markup for the panel, and init the thing by himself
        dojo.connect(dojo.byId(self._id+&#x27;-filter&#x27;), &#x27;onclick&#x27;, function(){
            dojo.query(&#x27;#pundit-vocabs-container div.pundit-tab-content div.semlib-panel&#x27;).removeClass(&#x27;semlib-selected&#x27;);
            dojo.addClass(self._id, &#x27;semlib-selected&#x27;);

            dojo.query(&#x27;#pundit-vocabs-header li&#x27;).removeClass(&#x27;pundit-selected&#x27;);
            dojo.addClass(self._id+&#x27;-filter&#x27;, &#x27;pundit-selected&#x27;);
        });
            
        dojo.query(&#x27;#pundit-vocabs-container div.pundit-tab-content&#x27;).append(html);
        
    },
    
    initBehaviors: function() {
        var self = this,
            selBeh = {};
        
        &#x2F;&#x2F; Key up listener, after a timer will initialize the remote call
        &#x2F;&#x2F; to feed the list
        dojo.connect(dojo.byId(self._id+&#x27;-input&#x27;), &#x27;onkeyup&#x27;, function (evt) {
            
            self.setLoading(false);
            clearTimeout(self.keyInputTimer);
            self.keyInputTimer = setTimeout(function() {
                
                &#x2F;&#x2F; TODO: disable the input until the results are back ?
                var keyword = dojo.byId(self._id+&#x27;-input&#x27;).value;
                if (keyword !== self._lastKeyword &amp;&amp; keyword.length &gt;= self.opts.keywordMinimumLength) {
                    self._lastKeyword = keyword;
                    self.log(&#x27;Show suggestions for term &#x27;+keyword+&#x27; on selector &#x27;+self.name);
                    self.showSuggestionsForTerm(dojo.byId(self._id+&#x27;-input&#x27;).value);
                }
                
            }, self.opts.keyInputTimerLength);
        });
        
        &#x2F;&#x2F; List item mouseover: show more info for this item
        &#x2F;&#x2F; TODO: move this to a function the user can overwrite
        selBeh[&#x27;#&#x27;+self._id+&#x27;-items li.dojoDndItem&#x27;] = {
                &#x27;onmouseover&#x27;: function (e) {
                    &#x2F;&#x2F; This gets called when hovering on every element inside this LI
                    var id = (dojo.hasClass(e.target, &#x27;pundit-icon-context-button&#x27;)||dojo.hasClass(e.target, &#x27;pundit-trim&#x27;)) ? dojo.query(e.target).parent()[0].id : e.target.id;
                    return self.dndItemMouseOverHandler(id);
                },
                &#x27;onmouseout&#x27;: function(e) {
                    if (e.target.className.match(&#x27;dojoDndItem&#x27;))
                        return self.dndItemMouseOutHandler(e.target.id);
                },
                &#x27;onclick&#x27;:function(e) {
                    var target = e.target;
                    while (!dojo.hasClass(dojo.query(target)[0], &#x27;dojoDndItem&#x27;))
                        target = dojo.query(target).parent()[0];
                    var id = target.id;
                    self.itemsDnD.selectNone();
                    self.itemsDnD.selection[id] = 1;
                }
            };
            
        &#x2F;&#x2F; Contextual menu trigger
        &#x2F;&#x2F; TODO: move this to a function the user can overwrite
        selBeh[&#x27;#&#x27;+self._id+&#x27;-items span.pundit-icon-context-button&#x27;] = {
                &#x27;onclick&#x27;: function (e){
                    var item = self.itemsDnD.getItem(dojo.query(e.target).parent()[0].id).data;
                    cMenu.show(e.pageX - window.pageXOffset, e.pageY - window.pageYOffset, item, &#x27;vocabItem&#x27;);
                }
            };
        dojo.behavior.add(selBeh);
        
    }, &#x2F;&#x2F; initBehaviors()
    
    dndItemMouseOverHandler: function(id) {
        var self = this,
            item = self.itemsDnD.getItem(id).data;

        if (!previewer.exists(item.value))
            previewer.buildPreviewForItem(item);
        previewer.show(item.value);

        return false;
    },
    dndItemMouseOutHandler: function() {
        return false;
    },
    
    setLoading: function(v) {
        var self = this,
            r = dojo.query(&#x27;#&#x27; + self._id),
            c = &#x27;pundit-panel-loading&#x27;;
        return (v) ? r.addClass(c) : r.removeClass(c);
    },

    &#x2F;**
    * @method setItemsLayout
    * @description Switches the layout of the presented items and rearrange
    * them accordingly.
    * @param name {string} Name of the layout. See constructor options.layouts
    *&#x2F;
    setItemsLayout: function(name) {
        var self = this,
            layouts = self.opts.layouts; 

        dojo.query(&#x27;#reconSelectorHeader .pundit-sort-items&#x27;).removeClass(&#x27;pundit-selected&#x27;);
        dojo.query(&#x27;#reconSelectorHeader .pundit-sort-items.&#x27;+name).addClass(&#x27;pundit-selected&#x27;);

        for (var i = layouts.length;i--;) 
            dojo.query(&#x27;#reconItems&#x27;).removeClass(layouts[i]);
    
        dojo.query(&#x27;#reconItems&#x27;).addClass(name);
    },

    &#x2F;&#x2F; Shows the suggestions in the panel, for the given term
    showSuggestionsForTerm: function(term) { 
        var self = this;
        self.setLoading(true);
        self.getItemsForTerm(term, 
            function(items) {
                self.itemsDnD.selectAll();
                self.itemsDnD.deleteSelectedNodes();
                dojo.removeClass(dojo.query(self._id + &#x27; .pundit-items-container&#x27;), &#x27;pundit-lookup-error&#x27;);
                dojo.empty(self._id+&#x27;-items&#x27;);

                if (items.length === 0) {
                    dojo.query(&#x27;#&#x27;+ self._id +&#x27;-message&#x27;).html(&#x27;No results found ...&#x27;);
                } else {
                    dojo.query(&#x27;#&#x27;+ self._id +&#x27;-message&#x27;).html(items.length+&#x27; results found:&#x27;);

                    self.itemsDnD.insertNodes(false, items);
                    dojo.behavior.apply();
                }
                self.setLoading(false);
            },
            function(){
                self.setLoading(false);
                dojo.addClass(dojo.query(&#x27;#&#x27; + self._id + &#x27; .pundit-items-container&#x27;)[0], &#x27;pundit-lookup-error&#x27;);
            });
                
    }, &#x2F;&#x2F; showSuggestionsForTerm()
    
    &#x2F;&#x2F; (async) Return a list of items for the given term, calling the callback func
    getItemsForTerm: function(term, func) {
        var self = this;
        self.log(&#x27;ERROR: Selector &#x27;+self.name+&#x27; does not implement getItemsForTerm&#x27;);
    },
    cancelRequests:function(){
        var self = this;
        self.log(&#x27;ERROR: Selector &#x27;+self.name+&#x27; does not implement cancelRequests&#x27;);
    }

});
    </pre>
							</div>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
	<script>prettyPrint();</script>
	<script src="..&#x2F;assets/js/yui-prettify.js"></script>
	<script src="..&#x2F;assets/../api.js"></script>
	<script src="..&#x2F;assets/js/api-filter.js"></script>
	<script src="..&#x2F;assets/js/api-list.js"></script>
	<script src="..&#x2F;assets/js/api-search.js"></script>
	<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
